# Session 2025-12-02 - SYNAPSE Cleanup & Admin Tools

## Summary

Major cleanup and admin features added to SYNAPSE frontend and backend.

---

## Changes Made

### 1. Database Cleanup

**Deleted 12 test projects**, keeping only:
- Project: `GoldMine Phase 1 - Crushing` (ID: `956c8c17-bfe0-4c72-867e-1e0b5c0180d8`)
- Client: `Goldmine Corp`
- 32 assets remaining

### 2. Project Management UI

**File:** `frontend/src/components/projects/ProjectSelector.tsx`

Added gear icon (⚙️) next to project dropdown with:
- **New Project** - Create project with modal
- **Clear Assets** - Delete all assets (keeps rules)
- **Delete Project** - Full cascade delete with confirmation

### 3. CSV Import Fix

**File:** `backend/app/api/endpoints/import_export.py`

- Added **case-insensitive column matching** for CSV headers
- Now accepts `TAG`, `Tag`, `tag` etc.
- Fixed for `sample_pid_import.csv` with uppercase headers

### 4. Database Schema Fixes

Added missing columns to `metamodel_nodes`:
```sql
ALTER TABLE metamodel_nodes ADD COLUMN description VARCHAR;
ALTER TABLE metamodel_nodes ADD COLUMN confidence_score FLOAT DEFAULT 1.0;
ALTER TABLE metamodel_nodes ADD COLUMN data_source_id VARCHAR;
```

Added missing enum value:
```sql
ALTER TYPE disciplinetype ADD VALUE 'GENERAL';
```

### 5. Menu Cleanup

**File:** `frontend/src/components/Layout.tsx`

**Before:**
```
Project → Overview
Data Ingestion → Import Wizard, Legacy Import, Validation Results
Engineering → Asset Explorer, Location Hierarchy
Automation → Rules Library, Rule Executor
Outputs → Cable Schedule
Admin → Metamodel Editor
```

**After:**
```
Project → Overview
Data → Import, Validation
Engineering → Asset Explorer, Locations
Automation → Rules Library
Outputs → Cable Schedule
Admin → Activity Log, Rule Executor, Admin Tools, Metamodel
```

**Removed:** Legacy Import (`/ingestion`)
**Moved:** Rule Executor to Admin section
**Added:** Activity Log, Admin Tools

### 6. Backend Admin Endpoints

**New file:** `backend/app/api/endpoints/admin.py`

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/v1/admin/activity` | GET | Combined action_logs + workflow_events |
| `/api/v1/admin/stats` | GET | Asset/cable/log counts |
| `/api/v1/admin/seed-demo` | POST | Run seed_demo.py |
| `/api/v1/admin/execute-rules` | POST | Execute all rules |
| `/api/v1/admin/clear-data` | DELETE | Clear project data (confirm=true) |

### 7. Frontend Admin Pages

**New file:** `frontend/src/pages/AdminActivity.tsx`
- Activity log viewer with combined action_logs + workflow_events
- Stats cards (assets, cables, logs)
- Filters by time range and entity type
- Expandable log details
- JSON export

**New file:** `frontend/src/pages/AdminTools.tsx`
- **Seed Demo Data** - Add test data
- **Execute All Rules** - Run rule engine
- **Clear All Data** - Delete everything (with confirmation modal)

### 8. Routes Added

**File:** `frontend/src/App.tsx`

```tsx
<Route path="/admin/activity" element={<AdminActivity />} />
<Route path="/admin/tools" element={<AdminTools />} />
```

---

## Files Modified

### Backend
- `app/main.py` - Added admin router
- `app/api/endpoints/admin.py` - NEW
- `app/api/endpoints/import_export.py` - Case-insensitive CSV
- `app/api/endpoints/projects.py` - DELETE endpoints

### Frontend
- `src/App.tsx` - New routes
- `src/components/Layout.tsx` - Menu restructure
- `src/components/projects/ProjectSelector.tsx` - Project management UI
- `src/pages/AdminActivity.tsx` - NEW
- `src/pages/AdminTools.tsx` - NEW

---

## Database State

```
Projects: 1 (GoldMine Phase 1 - Crushing)
Clients: 1 (Goldmine Corp)
Assets: 32
Action Logs: 133+
Workflow Events: 116+
Rule Definitions: 16
```

---

## How to Test

1. **Activity Log:** Menu → Admin → Activity Log
2. **Admin Tools:** Menu → Admin → Admin Tools
3. **Project Management:** Click ⚙️ next to project selector
4. **CSV Import:** Data → Import → Upload `backend/data/sample_pid_import.csv`

---

## Known Issues

- None currently

---

*Session end: 2025-12-02 ~02:00*
